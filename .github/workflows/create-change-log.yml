name: Debug Changelog Generation

on:
  workflow_dispatch:
    inputs:
      tag:
        required: true
        description: 'New release tag (e.g. v2.66.0)'
        type: string
        default: 'v2.66.0'
      previous-tag:
        required: true
        description: 'Previous release tag (e.g. v2.65.0)'
        type: string
        default: 'v2.65.0'
      dry-run:
        required: true
        description: 'Dry run (no tag/release push)?'
        type: boolean
        default: true

jobs:
  debug-changelog:
    name: Debug changelog generation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'yarn'

      - name: Install dependencies
        run: yarn install

      - name: Fetch all tags
        run: git fetch --tags --force

      - name: Print tags (debug)
        run: git tag --list | sort -V

      - name: Run changelog script
        id: changelog
        run: |
          echo "Generating changelog from ${{ github.event.inputs.previous-tag }} to ${{ github.event.inputs.tag }}..."
          node ./scripts/get-changelog.js -f ${{ github.event.inputs.previous-tag }} -t ${{ github.event.inputs.tag }} >> changelog.txt
          echo "✅ changelog.txt content:"
          cat changelog.txt

      - name: Print completion status
        run: echo "✅ Dry run complete. No tags or releases were created."
